# ğŸ”„ SMART DOBI - SYSTEM FLOW DIAGRAM

## ğŸ“Š ALUR PENUH SISTEM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SMART DOBI SYSTEM                           â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ CUSTOMER â”‚      â”‚   WEB    â”‚      â”‚  ESP32   â”‚                â”‚
â”‚  â”‚  (User)  â”‚â—„â”€â”€â”€â”€â–ºâ”‚ BACKEND  â”‚â—„â”€â”€â”€â”€â–ºâ”‚   S3     â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚       â”‚                  â”‚                  â”‚                      â”‚
â”‚       â”‚                  â”‚                  â”‚                      â”‚
â”‚       â–¼                  â–¼                  â–¼                      â”‚
â”‚  WhatsApp          MongoDB           Hardware                     â”‚
â”‚ Notification        Database      (Relay/LED/Button)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ FLOW 1: CUSTOMER MULAKAN MESIN

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Customer Pilih Mesin                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CUSTOMER                    WEB                         BACKEND
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€1. Buka Kioskâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚â”€â”€2. GET /api/machinesâ”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚â—„â”€3. Return machine listâ”€â”€â”€â”€â”‚
   â”‚                         â”‚   (status: available)       â”‚
   â”‚                         â”‚                             â”‚
   â”‚â—„â”€4. Display machinesâ”€â”€â”€â”€â”‚                             â”‚
   â”‚   (Mesin 1: Tersedia)   â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€5. Click Mesin 1â”€â”€â”€â”€â”€â”€â–ºâ”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚â—„â”€6. Navigate toâ”€â”€â”€â”€â”€â”€â”€â”€â”‚                             â”‚
   â”‚   /payment/1            â”‚                             â”‚
   â”‚                         â”‚                             â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Payment & Start                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CUSTOMER                    WEB                         BACKEND
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€1. Masuk WhatsAppâ”€â”€â”€â”€â”€â–ºâ”‚                             â”‚
   â”‚   (0189892155)          â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€2. Click "Sahkan"â”€â”€â”€â”€â”€â–ºâ”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚â”€â”€3. POST /machines/1/startâ”€â–ºâ”‚
   â”‚                         â”‚   {whatsapp: "0189892155",  â”‚
   â”‚                         â”‚    amount: 5.00}            â”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚                             â”‚â”€â”€4. Save to MongoDB
   â”‚                         â”‚                             â”‚   - status: "washing"
   â”‚                         â”‚                             â”‚   - whatsapp saved
   â”‚                         â”‚                             â”‚   - transaction created
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚                             â”‚â”€â”€5. Send WhatsAppâ”€â”€â–ºğŸ“±
   â”‚                         â”‚                             â”‚   "Mesin 1 start!
   â”‚                         â”‚                             â”‚    Tunggu 30 minit"
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚â—„â”€6. Response: Successâ”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                         â”‚                             â”‚
   â”‚â—„â”€7. Success toastâ”€â”€â”€â”€â”€â”€â”€â”‚                             â”‚
   â”‚   "Pembayaran berjaya"  â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚â—„â”€8. Redirect to homeâ”€â”€â”€â”€â”‚                             â”‚
   â”‚                         â”‚                             â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: ESP32 Detect & Start Machine                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ESP32 S3                   BACKEND                      HARDWARE
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€1. Poll every 2sâ”€â”€â”€â”€â”€â”€â–ºâ”‚                             â”‚
   â”‚   GET /machines/1       â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚â—„â”€2. Returnâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                             â”‚
   â”‚   {status: "washing",   â”‚                             â”‚
   â”‚    whatsapp: "..."}     â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€3. Detect washing!     â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€4. Turn ON LED (berkelip) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºğŸ’¡ BLINK
   â”‚                         â”‚                             â”‚
   â”‚   ğŸ”” CUSTOMER SIGNAL:   â”‚                             â”‚
   â”‚   "Lampu berkelip =     â”‚                             â”‚
   â”‚    Masukkan baju &      â”‚                             â”‚
   â”‚    Tekan START button" â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚â—„â”€5. CUSTOMER TEKAN BUTTON START â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ğŸ”˜
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€6. Start timer (120s)  â”‚                             â”‚
   â”‚    Turn ON RELAYâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâš¡ RELAY ON
   â”‚    LED solid ON (not blink) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºğŸ’¡ SOLID
   â”‚                         â”‚                             â”‚
   â”‚    [MACHINE RUNNING]    â”‚                             â”‚
   â”‚                         â”‚                             â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: ESP32 Update Timer ke Backend (every 2 seconds)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ESP32 S3                   BACKEND                      WEB
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€Every 2sâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                             â”‚
   â”‚   PUT /machines/1/statusâ”‚                             â”‚
   â”‚   ?status=washing       â”‚                             â”‚
   â”‚   &time_remaining=118   â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚â”€â”€Update MongoDBâ”€â”€â”€â”€â”€â–ºğŸ’¾     â”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚â—„â”€Web poll every 2sâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                         â”‚   GET /machines             â”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚â”€â”€Return updated timerâ”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                         â”‚   time_remaining: 118       â”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚                             â”‚â”€â”€Display
   â”‚                         â”‚                             â”‚  1:58
   â”‚                         â”‚                             â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Reminder (25 minutes / 5 min remaining)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ESP32 S3                   BACKEND                      WhatsApp
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€Timer = 300s (5 min)â”€â”€â”€â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€POST /machines/1/â”€â”€â”€â”€â–ºâ”‚                             â”‚
   â”‚   reminder              â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚â”€â”€Send WhatsAppâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºğŸ“±
   â”‚                         â”‚   "MESIN 1 HAMPIR SIAP      â”‚
   â”‚                         â”‚    DALAM 5 MINIT LAGI!"     â”‚
   â”‚                         â”‚                             â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: Machine Complete (30 minutes done)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ESP32 S3                   BACKEND                      HARDWARE
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€Timer = 0sâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€Turn OFF RELAYâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâš¡ RELAY OFF
   â”‚â”€â”€Turn OFF LEDâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºğŸ’¡ LED OFF
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€PUT /machines/1/statusâ–ºâ”‚                             â”‚
   â”‚   ?status=available     â”‚                             â”‚
   â”‚   &time_remaining=0     â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚â”€â”€Update MongoDBâ”€â”€â”€â”€â”€â–ºğŸ’¾     â”‚
   â”‚                         â”‚   status: "available"       â”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚â”€â”€Send WhatsAppâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºğŸ“±
   â”‚                         â”‚   "MESIN 1 SIAP!            â”‚
   â”‚                         â”‚    Ambil pakaian anda"      â”‚
   â”‚                         â”‚                             â”‚

```

## ğŸ”§ FLOW 2: OWNER DASHBOARD - SET MAINTENANCE

```
OWNER                      WEB DASHBOARD               BACKEND
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€1. Loginâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                             â”‚
   â”‚   (Google OAuth)        â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚â—„â”€2. Dashboard loadedâ”€â”€â”€â”€â”‚                             â”‚
   â”‚   All machines shown    â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚â”€â”€3. Click "Set Broken"â”€â–ºâ”‚                             â”‚
   â”‚   on Mesin 3            â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚â”€â”€4. PATCH /machines/3/â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                         â”‚   admin-status              â”‚
   â”‚                         â”‚   {status: "broken"}        â”‚
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚                             â”‚â”€â”€5. Update MongoDB
   â”‚                         â”‚                             â”‚   status: "broken"
   â”‚                         â”‚                             â”‚
   â”‚                         â”‚â—„â”€6. Response: Successâ”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                         â”‚                             â”‚
   â”‚â—„â”€7. Success toastâ”€â”€â”€â”€â”€â”€â”€â”‚                             â”‚
   â”‚   "Status updated"      â”‚                             â”‚
   â”‚                         â”‚                             â”‚
   â”‚â—„â”€8. Refresh dashboardâ”€â”€â”€â”‚                             â”‚
   â”‚   Mesin 3: Maintenance  â”‚                             â”‚
   â”‚                         â”‚                             â”‚

```

## ğŸ”‘ KEY POINTS:

### 1. TIMER MASTER = ESP32 S3
- ESP32 mula timer bila button start ditekan
- ESP32 update timer ke backend every 2 seconds
- Web hanya DISPLAY timer dari backend
- Jika refresh, web ambil latest timer dari backend

### 2. BUTTON START WORKFLOW
```
Payment Done â†’ ESP32 detect â†’ LED BERKELIP (signal customer)
                               â†“
                     Customer masuk baju
                               â†“
                     Customer TEKAN BUTTON START
                               â†“
                     ESP32 start timer & relay
                               â†“
                     LED SOLID ON (machine running)
```

### 3. LED STATES
- OFF = Machine available (idle)
- BLINKING = Waiting for customer (payment done, masuk baju)
- SOLID ON = Machine running (washing)
- OFF = Machine complete (siap)

### 4. OWNER CONTROL
- Owner boleh set: "available" atau "broken"
- Bila set "broken" â†’ Customer tak nampak button "Pilih"
- Status "washing" hanya boleh dari payment flow

---

## ğŸ“± FULL CYCLE SUMMARY (30 MINIT)

```
T=0min:    Payment â†’ WhatsApp "Start" â†’ LED BLINK
T=0min:    Customer tekan START â†’ Timer start â†’ LED SOLID
T=25min:   WhatsApp "5 minit lagi"
T=30min:   Relay OFF, LED OFF, WhatsApp "SIAP"
```

---

## ğŸŒ WEB POLLING
```
Every 2 seconds:
Web â”€â”€GET /api/machinesâ”€â”€â–º Backend â”€â”€Read MongoDBâ”€â”€â–º Return latest data
                                                         â†“
Web update display â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(Timer, Status, etc.)
```
